# UI гайд

[English](README.md) | **Русский**

Эта страница описывает веб‑интерфейс, доступный по адресу `http://localhost` после запуска стека.

## Навигация

Основные страницы (левое меню):

- Documents
- Projects
- Models
- Chat
- Voice
- API
- Users
- Request Logs
- Profile

## Login

Путь: `/login`

### Что делает

- Отправляет учётные данные на `POST /auth/login`
- Сохраняет токен в `localStorage` под ключом `token`
- Перенаправляет на **Documents** (`/documents`)

### Дефолтные учётные данные (dev)

- Email: `admin@example.com`
- Password: `admin`

### Подсказки

- Если в `localStorage` уже есть токен, UI автоматически редиректит на `/documents`.
- Для выхода используйте меню → **Logout** (очищает `localStorage.token`).

## Documents

Путь: `/documents`

### Назначение

- Загрузка документов (файл или текст) в **проект**
- Отслеживание индексации (`loaded_chunks / total_chunks`)
- Поиск и удаление документов

### Панель загрузки (слева)

#### 1) Выбор проекта (обязательно)

- Проект определяет **embedding‑модель** для индексации.
- Выбранная embedding‑модель показывается read‑only после выбора проекта.

#### 2) Тип загрузки

- **File Upload**: поддерживаются `TXT`, `PDF`, `DOC`, `DOCX`
- **Text Input**: вставка текста напрямую

#### 3) Upload

- Нажмите **Upload**
- Документ появится в списке; прогресс будет обновляться

### Список документов (справа)

- **Search by name**: клиентский фильтр по имени
- **Filter by project**: фильтрация по проекту
- **Chunks**:
  - показывает прогрессбар во время индексации
  - после завершения показывает число чанков
- **Delete**:
  - удаляет документ из выбранного проекта

### Обновления в реальном времени

Страница слушает WebSocket:
- `/ws/documents`

Так UI показывает прогресс индексации без ручного обновления.

## Projects

Путь: `/projects`

### Назначение

Проекты разделяют индексы и настройки:

- у каждого проекта свой набор таблиц/коллекций (документы + вектора)
- у каждого проекта есть **embedding‑модель** для индексации/поиска

### Создание проекта

1) Нажмите **New Project**
2) Задайте **Project Name**
3) Выберите **Embedding Model**
   - список строится из установленных моделей с capability `embedding`
   - добавляется опция `frida` как RU‑ориентированная embedding модель
4) Нажмите **Save**

### Редактирование проекта

- Можно переименовать проект
- Embedding‑модель для существующего проекта в UI **не меняется** (заблокирована)

### Статистика проекта

В таблице показывается количество документов (**Documents**) по проекту (через `/api/projects/{id}/stats`).

### Обновления в реальном времени

Страница слушает:
- `/ws/projects`

и обновляет список/статистику без ручного refresh.

## Models

Путь: `/models`

### Назначение

Управление моделями:

- просмотр установленных моделей (Ollama)
- просмотр доступных моделей
- установка (“pull”) модели с выбранным размером
- live‑прогресс загрузки
- удаление установленных моделей

### Скриншот

![Models (иллюстрация)](../assets/ui-models.svg)

### Списки и фильтры

- **Search**: по имени/описанию
- **Фильтр capability**:
  - `embedding`
  - `vision`
  - `tools`
  - или `all`

### Установка модели

1) Найдите карточку со статусом **Available**
2) Выберите **size** (тег)
3) Нажмите **Install**

Прогресс виден:

- на карточке модели (проценты + прогрессбар)
- обновляется через WebSocket (без refresh)

### Удаление модели

Для установленной модели (**Installed**):

- нажмите **Delete**
- подтвердите

### Обновления в реальном времени

Страница слушает:
- `/ws/models`

чтобы обновлять прогресс и перечитывать списки после завершения загрузки.

## Chat

Путь: `/chat`

### Назначение

Чат с документами через RAG:

- выбираются релевантные чанки из выбранного проекта
- опционально применяется реранкер
- генерируется ответ выбранной моделью

### Управление (верхняя панель)

- **Project**: какой индекс документов использовать
- **Model**:
  - локальные Ollama модели (установленные)
  - модели OpenRouter (с префиксом `openrouter/...`)
  - embedding‑модели скрываются из списка
- **Использовать Reranker**: включить/выключить реранкинг
- **Гибридный поиск**: объединяет векторный и keyword поиск
- **Показывать размышления**: показывает “thinking” секцию (если есть)

### Как задавать вопросы

1) Выберите project и model  
2) Введите сообщение и нажмите **Send**

UI вызывает:
- `POST /api/ai/rag`

### Источники

Ответ ассистента может содержать:

- **Размышления** (сворачиваемо)
- **Источники** (сворачиваемо): файл, similarity, фрагмент, метаданные

### Push-to-talk (STT)

В поле ввода есть кнопка микрофона:

- Зажмите для записи → отпустите для отправки
- UI отправляет аудио на:
  - `POST /api/stt/transcribe` (по умолчанию `ru`)
- Распознанный текст отправляется как обычное сообщение

### Примечания / ограничения

- Нужен хотя бы один проект и хотя бы одна не‑embedding модель.
- Если STT/TTS сервисы не запущены, голосовые функции работать не будут.

## Voice (TTS/STT)

Путь: `/voice`

Страница‑песочница для:

- **TTS**: синтез речи (Silero)
- **STT**: распознавание речи (Whisper)

### Вкладка TTS

#### Управление

- **Voice**: загружается из `GET /api/tts/voices`
- **Language**: сейчас только `ru` (в UI отключено)
- **Speed**: 0.5× … 2.0×
- **Quality (sample rate)**: 8k / 24k / 48k
- **Quick phrases**: быстрые фразы для заполнения текста

#### Как синтезировать

1) Введите текст (до 1000 символов)
2) Нажмите **Synthesize**
3) Аудио воспроизведётся автоматически
4) Опционально: **Download** чтобы сохранить WAV

UI вызывает:
- `POST /api/tts/synthesize/stream`

### Вкладка STT

#### Управление

- **Whisper model**:
  - список из `GET /api/stt/models`
  - переключение вызывает `POST /api/stt/model/load`
- **Language**: язык распознавания (по умолчанию `ru`)

#### Как распознать

1) Нажмите кнопку микрофона для старта записи
2) Нажмите ещё раз для остановки
3) Дождитесь результата

UI вызывает:
- `POST /api/stt/transcribe` (multipart)

#### Действия с результатом

- Copy
- Clear
- Отправить в TTS (“Synthesize”)

## API / Swagger страница в UI

Путь: `/swagger`

Страница объединяет “вход” в API для пользователей UI:

- обзор внешних эндпоинтов
- ваши API‑ключи (быстрое копирование)
- примеры кода (curl / Python / JS)
- встроенная Swagger UI (`/api/docs`)

### Вкладки

#### API Overview

- Показывает основные группы эндпоинтов и их назначение.

#### My API Keys

- Показывает API‑ключи текущего пользователя
- Можно скопировать значение ключа
- Для управления (создать/удалить) ведёт на `/users`

#### Code Examples

- Copy‑paste примеры для:
  - RAG
  - OpenAI‑совместимого чата
  - TTS

#### Swagger Docs

- Встроенная интерактивная Swagger UI из `/api/docs`
- Подсказка: нажмите **Authorize** и вставьте токен/ключ в формате:

```
Bearer <TOKEN>
```

## Users & API keys

Путь: `/users`

### Назначение

- Управление пользователями (создание/редактирование/удаление)
- Управление **API‑ключами** пользователей (создание/копирование/удаление)

API‑ключи используются для внешних интеграций и передаются как:

```
Authorization: Bearer <API_KEY>
```

### Таблица пользователей

Показывает:

- Email
- Роль (Admin/User)
- Дата создания
- Действия:
  - **API Keys**
  - **Edit**
  - **Delete**

### Создание пользователя

1) Нажмите **Add User**
2) Заполните:
   - Email
   - Password
   - Role (`user` / `admin`)
3) Нажмите **Save**

### Редактирование пользователя

- Password можно оставить пустым, чтобы сохранить текущий пароль.

### Диалог API keys

1) Нажмите иконку **ключа** у пользователя
2) Создайте ключ:
   - задайте имя
   - нажмите **Create**
3) Скопируйте ключ (иконка copy)
4) При необходимости удаляйте ключи

> Храните API‑ключи в секрете — они дают доступ от имени пользователя.

## Request Logs

Путь: `/request-logs`

### Назначение

Просмотр истории запросов для мониторинга и отладки:

- какие эндпоинты вызываются
- время ответа / медленные запросы
- какая модель использовалась (если есть)

Страница использует:
- `GET /api/admin/logs` (для не‑админов доступен ограниченный вид)

### Фильтры

- Метод (GET/POST/PUT/DELETE)
- Path contains
- Диапазон дат/времени

Только для админов:

- Фильтр по пользователю
- Просмотр IP
- Просмотр request/response body в деталях
- Таблица “User Stats” (`/api/admin/stats/users`)

### Диалог деталей

Кнопка **Details** показывает:

- method, path, category
- model name
- response time
- user text (если сохранялся)
- request/response body (только админ)

## Profile

Путь: `/profile`

### Назначение

- Просмотр информации об аккаунте и активности
- Переключение темы интерфейса (light/system/dark)

### Что отображается

- **Аккаунт**
  - email / username
  - роль (administrator vs user)
  - дата регистрации
  - последняя активность
- **Статистика использования**
  - количество проектов
  - количество API‑ключей
  - запросов/месяц
  - использовано места (MB)
  - всего запросов
- **Recent activity**
  - method + path + response time
  - относительное время (“Just now”, “10 min ago”, ...)

### Тема

Тема хранится в `localStorage` (ключ `theme`) и применяется после перезагрузки страницы.

